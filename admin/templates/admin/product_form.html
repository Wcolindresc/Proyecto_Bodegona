{% extends "base.html" %}
{% block title %}Admin — Producto{% endblock %}
{% block content %}
  <h1 class="text-xl font-semibold mt-6 mb-4">{{ 'Editar' if product else 'Nuevo' }} producto</h1>
  <form method="post" class="grid md:grid-cols-2 gap-4 bg-white border rounded p-4">
    <input class="border rounded px-3 py-2" name="name" placeholder="Nombre" value="{{ product.name if product }}">
    <input class="border rounded px-3 py-2" name="slug" placeholder="slug-ejemplo" value="{{ product.slug if product }}">
    <textarea class="md:col-span-2 border rounded px-3 py-2" name="description" placeholder="Descripción">{{ product.description if product }}</textarea>
    <input class="border rounded px-3 py-2" name="price" type="number" step="0.01" placeholder="Precio" value="{{ product.price if product }}">
    <input class="border rounded px-3 py-2" name="stock" type="number" placeholder="Stock" value="{{ product.stock if product }}">
    <label class="flex items-center gap-2"><input type="checkbox" name="active" {% if product and product.active %}checked{% endif %}> Activo</label>
    <div class="md:col-span-2">
      <div class="text-sm text-gray-600 mb-1">Categorías</div>
      <div class="grid md:grid-cols-3 gap-2">
        {% for c in categories %}
          <label class="flex items-center gap-2">
            <input type="checkbox" name="categories" value="{{ c.id }}" {% if c.id in assigned %}checked{% endif %}>
            {{ c.name }}
          </label>
        {% endfor %}
      </div>
    </div>
    <div class="md:col-span-2">
      <button class="px-4 py-2 bg-blue-600 text-white rounded">Guardar</button>
    </div>
  </form>

  {% if product %}
  <div class="mt-6 grid md:grid-cols-2 gap-4">
    <div class="bg-white border rounded p-4">
      <div class="font-semibold mb-2">Imagen</div>
      {% if product.image_path %}<img src="{{ url_for('static', filename='') }}{{ product.image_path }}">{% endif %}
      <form method="post" action="{{ url_for('admin.products_upload_image', pid=product.id) }}" enctype="multipart/form-data" class="mt-2">
        <input type="file" name="file" required class="border rounded px-3 py-2 w-full">
        <button class="mt-2 px-3 py-2 bg-gray-800 text-white rounded">Subir/Reemplazar</button>
      </form>
    </div>
    <div class="bg-white border rounded p-4">
      <div class="font-semibold mb-2">Eliminar</div>
      <form method="post" action="{{ url_for('admin.products_delete', pid=product.id) }}">
        <button class="px-3 py-2 bg-red-600 text-white rounded" onclick="return confirm('¿Eliminar producto?')">Eliminar producto</button>
      </form>
    </div>
  </div>
  {% endif %}
{% endblock %}
